from bs4 import BeautifulSoup
from threading import Thread
import selenium
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
from datetime import date
import xlsxwriter  # NOTE: MUST USE MODULES THAT SUPPORT XLSX FORMAT (AND NOT XLS)
import time
import requests
import re

s = Service(ChromeDriverManager().install())
browser = webdriver.Chrome(service=s)

def task(url_submission):
    browser.get(url_submission)
    page = requests.get(url_submission)
    soup = BeautifulSoup(browser.page_source, "html.parser")
    price = (soup.find("span", {"class":"element-label price"})).text.strip()
    #bedroom_number = (soup.find("span", {"itemprop":"numberOfRooms"})).text.strip()
    bedroom_number = (soup.find("div"))
    bathroom_number = (soup.find())
    print(bathroom_number)





def webscrape():
    exit_URL_entry = False
    counter = 0
    list_of_URLs = []
    while exit_URL_entry == False:
        counter += 1
        url = input(
f"""
Enter URL {counter} 
If you have finished submitting all your URLs, enter DONE
""")
        if url.upper() != "DONE":
            list_of_URLs.append(url)

            #For checking purposes (might need to allow user to go back and change their previous inputs?)
            print(list_of_URLs)
        else:
            exit_URL_entry = True


    exit_main = False
    while exit_main == False:
        #street_address_column = []
        price_column = []
        bed_count_column = []
        bath_count_column = []
        floor_area_column = []
        psf_column = []
        # distance_to_nearest_transport_column = []
        # property_type_column = []
        # built_year_column = []
        # type_of_leasehold_column = []
        # lease_years_left_column = []
        ppg_link_column = []
        block_number_column = []

        # NOTE xlsxwriter does not allow me to modify existing files. It can only create new files
        # Openpyxl is an alternative module but idk why it just keeps bugging out for me
        save_location = "/Users/jinyangchen/PycharmProjects/Webscrape PropertyGuru/"
        workbook = xlsxwriter.Workbook(save_location + f"{key_word}" + ".xlsx")
        worksheet = workbook.add_worksheet("Data")

        # Fill up headers
        worksheet.write(0, 0, "Listing ID")
        worksheet.write(0, 1, "Agent")
        worksheet.write(0, 2, "Bedrooms")
        worksheet.write(0, 3, "Bathrooms")
        worksheet.write(0, 4, "Block")
        worksheet.write(0, 5, "Floor")
        worksheet.write(0, 6, "Condition")
        worksheet.write(0, 7, "Price")
        worksheet.write(0, 8, "Sqft")
        worksheet.write(0, 9, "Psf")
        worksheet.write(0, 10, "PPG Link")
        worksheet.write(0, 11, "PPG Link ID")

        # LISTING ID CORRECT
        number = 0
        for row_number in range(1, listing_counter + 1):
            number += 1
            worksheet.write(row_number, 0, number)

        # AGENT KIV

        # BEDROOMS CORRECT
        bed_count_column_rowcounter = 0
        for entry in bed_count_column:
            bed_count_column_rowcounter += 1
            worksheet.write(bed_count_column_rowcounter, 2, entry)

        # BATHROOMS CORRECT
        bath_count_column_rowcounter = 0
        for entry in bath_count_column:
            bath_count_column_rowcounter += 1
            worksheet.write(bath_count_column_rowcounter, 3, entry)

        # BLOCK IN PROGRESS
        block_number_rowcounter = 0
        for entry in block_number_column:
            block_number_rowcounter += 1
            worksheet.write(block_number_rowcounter, 4, entry)

        # FLOOR KIV

        # CONDITION KIV

        # PRICE CORRECT
        price_column_rowcounter = 0
        for entry in price_column:
            modified_price_input = "$" + entry
            price_column_rowcounter += 1
            worksheet.write(price_column_rowcounter, 7, modified_price_input)

        # SQFT CORRECT
        floor_area_column_rowcounter = 0
        for entry in floor_area_column:
            modified_floor_area_input = entry.replace(" sqft", "")
            floor_area_column_rowcounter += 1
            worksheet.write(floor_area_column_rowcounter, 8, modified_floor_area_input)

        # PSF CORRECT
        psf_column_rowcounter = 0
        for entry in psf_column:
            modified_psf_input_draft = ""
            for character in entry:
                if character.isdigit() or character == ".":
                    modified_psf_input_draft += character
            modified_psf_input = round(float(modified_psf_input_draft))
            psf_column_rowcounter += 1
            worksheet.write(psf_column_rowcounter, 9, modified_psf_input)

        # PPG LINK CORRECT
        ppg_link_rowcounter = 0
        for entry in ppg_link_column:
            ppg_link_rowcounter += 1
            worksheet.write(ppg_link_rowcounter, 10, entry)

        # PPG LINK ID CORRECT
        list_of_listing_id_column_rowcounter = 0
        for entry in list_of_listing_id:
            list_of_listing_id_column_rowcounter += 1
            worksheet.write(list_of_listing_id_column_rowcounter, 11, entry)



    #browser.quit()


task("https://www.propertyguru.com.sg/listing/22294754/for-sale-seraya-residences")
